### **反思-响应系统 (The Reflexive-Responsive System R²S)**

R²S 是一个分层的形式计算模型，旨在统一描述结构演化与异步事件响应。它由一个进行宏观结构重写的 **宏观层 (Macro-level)** 和内嵌于该结构中、负责处理局部事件的 **微观层 (Micro-level)** 组成。

---

### **1. 语法 (Syntax)**

#### **1.1. 基础集合 (Primitive Sets)**

R²S 的定义基于以下基础集合：

*   **宏观层集合 (Macro-level Sets):**
    *   `A`：一个可数的原子项集合 (Atoms)。
    *   `V`：一个可数的位点标识符集合 (Site Identifiers)。
    *   `F`：一个带元数 (arity) 的函数符号集合 (Function Symbols)。

*   **微观层集合 (Micro-level Sets):**
    *   `T_μ`：微观项的集合 (Micro-Terms)，用于构成转移。
    *   `L`：一个可数的位主标识符集合 (Locus Identifiers)。
    *   `Q`：一个预定义的、非空的状态集 (Locus States)。

#### **1.2. 微观层结构 (Micro-level Structures)**

微观层定义了系统内部的事件处理机制。

*   **转移 (Transition):** 一个转移 `τ` 是一个有序对 `(t_in, t_out)`，其中 `t_in, t_out ∈ T_μ`。令 `P_base = T_μ × T_μ` 为所有可能转移的集合。
*   **转移池 (Transition Pool):** 一个转移池 `P` 是 `P_base` 的一个有限子集，`P ⊆ ℘(P_base)`。
*   **吸收性位主 (Absorptive Locus):** 一个吸收性位主 `λ` 是一个五元组 `(l, q, A, M, E)`，其中：
    *   `l ∈ L` 是唯一标识符。
    *   `q ∈ Q` 是当前状态。
    *   `A` 是适用性函数 (Applicability Function)。
    *   `M` 是状态变形函数 (State Morphing Function)。
    *   `E` 是转移发射函数 (Transition Emission Function)。
    令 `Λ_base` 为所有可能的吸收性位主的集合。
*   **位主集 (Set of Loci):** 一个位主集 `Λ` 是 `Λ_base` 的一个有限子集，`Λ ⊆ ℘(Λ_base)`。
*   **微观格局 (Micro-Configuration):** 一个微观格局 `K` 是一个二元组 `(Λ, P)`。令 `K_set` 为所有可能的微观格局的集合。

#### **1.3. 宏观层结构 (Macro-level Structures)**

宏观层定义了系统的整体结构及其演化单元。

*   **响应性位点 (Responsive Site):** 一个响应性位点 `σ` 是一个四元组 `(v, K, U, G)`，其中：
    *   `v ∈ V` 是唯一标识符。
    *   `K ∈ K_set` 是该位点的内部微观格局。
    *   `U` 是情境注入函数 (Context Injection Function)。
    *   `G` 是格局驱动的规则生成函数 (Rule Generator Function)。
    令 `Σ` 为所有可能的响应性位点的集合。

*   **宏观项 (Macro-Term):** 宏观项的集合 `T_M` 被归纳定义如下：
    1.  如果 `a ∈ A`，那么 `a ∈ T_M`。
    2.  如果 `σ ∈ Σ`，那么 `σ ∈ T_M`。
    3.  如果 `f ∈ F`，`arity(f) = n`，且 `t₁, ..., tₙ ∈ T_M`，那么 `f(t₁, ..., tₙ) ∈ T_M`。

*   **上下文 (Context):** 上下文的集合 `C` 是带有一个唯一“空位” `[]` 的宏观项。其归纳定义如下：
    1.  `[]` 是一个上下文。
    2.  如果 `f ∈ F`，`arity(f) = n`，`t₁, ..., tᵢ₋₁, tᵢ₊₁, ..., tₙ ∈ T_M`，且 `Cᵢ` 是一个上下文，那么 `f(t₁, ..., tᵢ₋₁, Cᵢ, tᵢ₊₁, ..., tₙ)` 是一个上下文。
    若 `C ∈ C` 且 `t ∈ T_M`，则 `C[t]` 表示将 `C` 中的空位 `[]` 替换为项 `t` 后得到的宏观项。

---

### **2. 核心函数组件 (Core Functional Components)**

#### **2.1. 微观层函数 (Micro-level Functions)**

这些函数定义了吸收性位主 `λ = (l, q, A, M, E)` 的行为。

*   **适用性函数 `A` (Applicability):** `A: Q × P_base → Bool`
    `A(q, τ)` 决定了处于状态 `q` 的位主是否可以吸收转移 `τ`。

*   **状态变形函数 `M` (Morphing):** `M: Q × P_base → Q`
    `M(q, τ)` 计算位主在状态 `q` 下吸收转移 `τ` 后的新状态。

*   **转移发射函数 `E` (Emission):** `E: Q → ℘(P_base)`
    `E(q)` 根据位主的新状态 `q` 生成一个（可能为空的）新转移集合。

#### **2.2. 宏观层函数 (Macro-level Functions)**

这些函数定义了响应性位点 `σ = (v, K, U, G)` 的行为。

*   **情境注入函数 `U` (Context Injection):** `U: K_set × C → K_set`
    `U(K, C)` 接收位点当前的内部微观格局 `K` 及其所处的宏观上下文 `C`，并计算出一个新的微观格局 `K'`。此过程代表了位点对外部环境的内部响应。

*   **格局驱动的规则生成函数 `G` (Rule Generator):** `G: K_set × C → R_M`
    其中 `R_M` 是形如 `σ → t'`（`t' ∈ T_M`）的重写规则集合。`G(K, C)` 接收一个微观格局 `K` 和一个宏观上下文 `C`，并生成一条用于宏观结构演化的重写规则。

---

### **3. 系统动力学 (System Dynamics)**

#### **3.1. 微观层转移关系 (Micro-level Transition Relation)**

微观格局的单步转移关系 `⇒ ⊆ K_set × K_set` 由以下推导规则定义：

```
K = (Λ, P)
λ ∈ Λ, τ ∈ P
λ = (l, q, A, M, E)
A(q, τ) = True
--------------------------------------------------------------------------------------
q' = M(q, τ)
P_new = E(q')
λ' = (l, q', A, M, E)
K' = ( (Λ \ {λ}) ∪ {λ'}, (P \ {τ}) ∪ P_new )
--------------------------------------------------------------------------------------
(Λ, P) ⇒ ( (Λ \ {λ}) ∪ {λ'}, (P \ {τ}) ∪ P_new )
```
*   `⇒*` 是 `⇒` 的自反传递闭包。

#### **3.2. 宏观层系统格局 (Macro-level System Configuration)**

一个 R²S 系统的格局就是一个宏观项 `t ∈ T_M`。

#### **3.3. 宏观层单步转移关系 (Macro-level One-Step Transition Relation)**

R²S 系统的单步转移关系 `→ ⊆ T_M × T_M` 由以下推导规则定义：

```
t_current ∈ T_M
∃σ ∈ Σ, ∃C ∈ C such that t_current = C[σ]
--------------------------------------------------------------------------------------
σ = (v, K, U, G)
K' = U(K, C)
(σ → t_new_inner) = G(K', C)
t_next = C[t_new_inner]
--------------------------------------------------------------------------------------
t_current → t_next
```
*   此规则是非确定性的：若项 `t_current` 中包含多个响应性位点，任何一个位点都可以被选择以触发一次转移。
*   `→*` 是 `→` 的自反传递闭包，表示多步演化。

---

### **4. 符号表摘要**

| 符号             | 名称                       | 层级   | 描述                                             |
| :--------------- | :------------------------- | :----- | :----------------------------------------------- |
| `A`, `V`, `F`    | 原子, 位点标识符, 函数符号 | 宏观   | 构造宏观项的基础集合。                           |
| `T_μ`, `L`, `Q`  | 微观项, 位主标识符, 位主状态 | 微观   | 构造微观格局的基础集合。                         |
| `τ ∈ P_base`     | 转移                       | 微观   | `(t_in, t_out)`，系统中的基本事件单元。          |
| `P`              | 转移池                     | 微观   | 当前待处理的转移的有限集合。                     |
| `λ`              | 吸收性位主                 | 微观   | `(l, q, A, M, E)`，微观层的核心计算单元。        |
| `Λ`              | 位主集                     | 微观   | 当前活跃的位主的有限集合。                       |
| `K = (Λ, P)`     | 微观格局                   | 微观   | 微观系统的完整状态。                             |
| `σ`              | 响应性位点                 | 宏观   | `(v, K, U, G)`，宏观层的核心计算单元。           |
| `t ∈ T_M`        | 宏观项                     | 宏观   | R²S 系统的完整格局/状态。                      |
| `C`              | 上下文                     | 宏观   | 带一个空位 `[]` 的宏观项。                       |
| `A`, `M`, `E`    | 适用性, 变形, 发射函数     | 微观   | 定义位主 `λ` 行为的函数。                        |
| `U`, `G`         | 注入, 规则生成函数         | 宏观   | 定义位点 `σ` 行为的函数。                        |
| `⇒`              | 微观转移关系               | 微观   | 微观格局 `K` 之间的单步演化关系。                |
| `→`              | 宏观转移关系               | 宏观   | 宏观项 `t`（系统格局）之间的单步演化关系。       |